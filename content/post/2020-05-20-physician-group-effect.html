---
title: Causal Forest Example 
author: Ben Koos
date: '2020-05-20'
slug: causal-forest-example
categories:
  - R
tags:
  - Causal Forest
---



<div id="load-and-clean-data" class="section level2">
<h2>Load and Clean Data</h2>
<pre class="r"><code>rm(list = ls())
require(grf)</code></pre>
<pre><code>## Loading required package: grf</code></pre>
<pre class="r"><code>require(ggplot2)</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre class="r"><code>Data = read.delim(&quot;http://www.biostat.jhsph.edu/~cfrangak/biostat_causal/asthma.txt&quot;)
Data = data.frame( matrix( unlist( strsplit( gsub( &quot;^ &quot;,&quot;&quot;,Data[,1] ) , &quot; &quot;)), nrow = 276, byrow = T))
colnames(Data) = c(&quot;pg&quot; , &quot;i.age&quot;, &quot;i.sex&quot;, &quot;i.educ&quot;, &quot;i.insu&quot;, &quot;i.drug&quot;, &quot;i.seve&quot;, &quot;com.t&quot;, &quot;pcs.sd&quot;, &quot;mcs.sd&quot;, &quot;i.aqoc&quot;)
for ( i in 1:ncol(Data))  { 
  Data[,i] = as.numeric(Data[,i])
}</code></pre>
</div>
<div id="estimate-causal-forest" class="section level2">
<h2>Estimate Causal Forest</h2>
<pre class="r"><code>X = Data[,2:10] 
Treat = Data$pg - 1
Outome = Data$i.aqoc
tau.forest = causal_forest( as.matrix(X),Outome,Treat, num.trees = 100)</code></pre>
</div>
<div id="average-treatment-effect" class="section level2">
<h2>Average Treatment Effect:</h2>
<pre class="r"><code>average_treatment_effect(forest =tau.forest , target.sample = &quot;treated&quot;)</code></pre>
<pre><code>##    estimate     std.err 
## -0.16612054  0.06137243</code></pre>
</div>
<div id="heterogenous-treatment-effects" class="section level2">
<h2>Heterogenous Treatment Effects</h2>
<p><img src="/post/2020-05-20-physician-group-effect_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
